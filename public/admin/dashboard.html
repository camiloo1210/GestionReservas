<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .sidebar {
            min-height: 100vh;
            border-right: 1px solid #333;
        }

        .sidebar a {
            color: #adb5bd;
            text-decoration: none;
            display: block;
            padding: 10px 20px;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background-color: #c70039;
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar p-3" style="width: 250px;">
            <h4 class="mb-4 text-center">Admin Panel</h4>
            <a href="dashboard.html" class="active">Inicio</a>
            <a href="rooms.html">Salas</a>
            <a href="reservations.html">Reservas</a>
            <a href="#" onclick="logout()" class="mt-5">Cerrar Sesión</a>
        </div>

        <!-- Content -->
        <div class="flex-grow-1 p-4">
            <h2>Reporte de uso de salas</h2>
            <p>Seleccione un rango de fechas para visualizar el uso.</p>

            <!-- Filtros -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <label>Fecha inicio</label>
                    <input type="date" id="start_date" class="form-control">
                </div>
                <div class="col-md-3">
                    <label>Fecha fin</label>
                    <input type="date" id="end_date" class="form-control">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-danger w-100" onclick="loadReport()">
                        Ver reporte
                    </button>
                </div>
            </div>

            <!-- Tabla -->
            <table class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th>Sala</th>
                        <th>Total de reservas</th>
                    </tr>
                </thead>
                <tbody id="reportTable">
                    <!-- Datos dinámicos -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function loadReport() {
            const start = document.getElementById("start_date").value;
            const end = document.getElementById("end_date").value;

            if (!start || !end) {
                alert("Seleccione ambas fechas");
                return;
            }

            fetch(`/api/reservations/report/usage?start_date=${start}&end_date=${end}`)
                .then(res => res.json())
                .then(data => {
                    const table = document.getElementById("reportTable");
                    table.innerHTML = "";

                    if (data.length === 0) {
                        table.innerHTML = `<tr><td colspan="2">No hay datos</td></tr>`;
                        return;
                    }

                    data.forEach(row => {
                        table.innerHTML += `
                            <tr>
                                <td>${row.room_name}</td>
                                <td>${row.total_reservations}</td>
                            </tr>
                        `;
                    });
                });
        }

        function logout() {
            fetch('/api/auth/logout', { method: 'POST' })
                .then(() => window.location.href = '/index.html');
        }
    </script>
</body>

</html>
